<html>
<head>
    <meta charset="UTF-8">
    <script src="libraries/lodash.js"></script>    
    <script language="javascript" type="text/javascript" src="libraries/p5.js"></script>
    <!-- uncomment lines below to include extra p5 libraries -->
    <!-- <script language="javascript" src="libraries/p5.dom.js"></script> -->
    <!-- <script language="javascript" src="libraries/p5.sound.js"></script> -->
    <script language="javascript" type="text/javascript" src="sketch.js"></script>
    <!-- this line removes any default padding and style. you might only need one of these values set. -->
    <style> body {padding: 0; margin: 0;} </style>

    <script>

    var midiAccess;
    // var disp;

    window.addEventListener("load", function(){ //when page loads
        // Instantiate Display object which underpins the whole UI
        // disp = new Display();
        var myp5 = new p5(p5sketch);

        // Handle dropdown input selector
        var dropdown = document.getElementById("inports_selector");
        dropdown.addEventListener("change", function() {
            var inputs = midiAccess.inputs.values();
            for (var input = inputs.next(); input && !input.done; input = inputs.next()) {
                // Assign callback function to the selected MIDI input
                if (input.value.name == this.value) {
                    input.value.onmidimessage = onMIDIMessage;
                } else {
                    input.value.onmidimessage = null;
                }
            }
        });
    });

    // request MIDI access
    if (navigator.requestMIDIAccess) {
        navigator.requestMIDIAccess({
            sysex: false
        }).then(onMIDISuccess, onMIDIFailure);
    } else {
        alert("No MIDI support in your browser.");
    }

    function onMIDISuccess(midiAccess_) {
        midiAccess = midiAccess_
        var inputs = midiAccess.inputs.values();
        for (var input = inputs.next(); input && !input.done; input = inputs.next()) {
            // Populate dropdown menu with available ports
            var dropdown = document.getElementById("inports_selector");
            var option = document.createElement("option");
            option.text = input.value.name;
            dropdown.add(option);
        }
    }
    function onMIDIFailure(e) {
        // when we get a failed response, run this code
        console.log("No access to MIDI devices or your browser doesn't support WebMIDI API. Please use WebMIDIAPIShim " + e);
    }

    </script>
</head>

<body>
    <select id="inports_selector" style="position: absolute">
        <option value=null>--</option>
    </select>
</body>
</html>
